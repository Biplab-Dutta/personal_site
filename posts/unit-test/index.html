<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="A deep dive into unit testing in Flutter 🧪" /><meta name="author" content="Biplab Dutta" /><meta property="og:locale" content="en" /><meta name="description" content="Testing code is an important task for a developer that helps us in ensuring that our code works as expected. Testing is an important task that should not be given the least priority or be neglected. Many companies seeking for a software developer candidate look for those who can perform testing effectively. Many open-source projects don’t prefer to merge contributions for which tests are not included. So, it is clear that testing is a must-have skill for a developer and in this blog, we will go in depth about unit testing in Flutter. 😎 Testing doesn’t help in locating bugs. It only helps in making sure that our code works as expected. It gives us the confidence that our code works even after refactoring the codebase. In Flutter, there are mainly three types of test but not limiting to. They are:" /><meta property="og:description" content="Testing code is an important task for a developer that helps us in ensuring that our code works as expected. Testing is an important task that should not be given the least priority or be neglected. Many companies seeking for a software developer candidate look for those who can perform testing effectively. Many open-source projects don’t prefer to merge contributions for which tests are not included. So, it is clear that testing is a must-have skill for a developer and in this blog, we will go in depth about unit testing in Flutter. 😎 Testing doesn’t help in locating bugs. It only helps in making sure that our code works as expected. It gives us the confidence that our code works even after refactoring the codebase. In Flutter, there are mainly three types of test but not limiting to. They are:" /><link rel="canonical" href="https://biplabdutta.com.np/posts/unit-test/" /><meta property="og:url" content="https://biplabdutta.com.np/posts/unit-test/" /><meta property="og:site_name" content="Biplab Dutta" /><meta property="og:image" content="https://raw.githubusercontent.com/Biplab-Dutta/personal_site/main/preview_images/unit_test.png" /><meta property="og:image:alt" content="Preview Image Credit - raywenderlich.com" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-20T09:00:00+05:45" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://raw.githubusercontent.com/Biplab-Dutta/personal_site/main/preview_images/unit_test.png" /><meta name="twitter:image:alt" content="Preview Image Credit - raywenderlich.com" /><meta property="twitter:title" content="A deep dive into unit testing in Flutter 🧪" /><meta name="twitter:site" content="@b_plab98" /><meta name="twitter:creator" content="@b_plab98" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Biplab Dutta","url":"https://twitter.com/b_plab98"},"dateModified":"2022-10-09T19:44:16+05:45","datePublished":"2022-08-20T09:00:00+05:45","description":"Testing code is an important task for a developer that helps us in ensuring that our code works as expected. Testing is an important task that should not be given the least priority or be neglected. Many companies seeking for a software developer candidate look for those who can perform testing effectively. Many open-source projects don’t prefer to merge contributions for which tests are not included. So, it is clear that testing is a must-have skill for a developer and in this blog, we will go in depth about unit testing in Flutter. 😎 Testing doesn’t help in locating bugs. It only helps in making sure that our code works as expected. It gives us the confidence that our code works even after refactoring the codebase. In Flutter, there are mainly three types of test but not limiting to. They are:","headline":"A deep dive into unit testing in Flutter 🧪","image":{"alt":"Preview Image Credit - raywenderlich.com","url":"https://raw.githubusercontent.com/Biplab-Dutta/personal_site/main/preview_images/unit_test.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://biplabdutta.com.np/posts/unit-test/"},"url":"https://biplabdutta.com.np/posts/unit-test/"}</script><title>A deep dive into unit testing in Flutter 🧪 | Biplab Dutta</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Biplab Dutta"><meta name="application-name" content="Biplab Dutta"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/63902683?v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Biplab Dutta</a></div><div class="site-subtitle font-italic">Flutter Developer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/Biplab-Dutta" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/b_plab98" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://linkedin.com/in/biplab-dutta-43774717a" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://stackoverflow.com/users/10167900/biplab-dutta" aria-label="stack-overflow" target="_blank" rel="noopener"> <i class="fab fa-stack-overflow"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>A deep dive into unit testing in Flutter 🧪</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4 pb-5"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>A deep dive into unit testing in Flutter 🧪</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1660965300" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 20, 2022 </em> </span> <span> Updated <em class="" data-ts="1665323956" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 9, 2022 </em> </span><div class="mt-3 mb-3"> <img data-src="https://raw.githubusercontent.com/Biplab-Dutta/personal_site/main/preview_images/unit_test.png" class="preview-img bg" alt="Preview Image Credit - raywenderlich.com" data-proofer-ignore><figcaption class="text-center pt-2 pb-2">Preview Image Credit - raywenderlich.com</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/b_plab98">Biplab Dutta</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4811 words"> <em>26 min</em> read</span></div></div></div><div class="post-content"><p>Testing code is an important task for a developer that helps us in ensuring that our code works as expected. Testing is an important task that should not be given the least priority or be neglected. Many companies seeking for a software developer candidate look for those who can perform testing effectively. Many open-source projects don’t prefer to merge contributions for which tests are not included. So, it is clear that testing is a must-have skill for a developer and in this blog, we will go in depth about unit testing in Flutter. 😎 Testing <strong>doesn’t</strong> help in locating bugs. It only helps in making sure that our code works as expected. It gives us the confidence that our code works even after refactoring the codebase. In Flutter, there are mainly three types of test but not limiting to. They are:</p><ul><li>Unit Testing<li><a href="https://docs.flutter.dev/cookbook/testing/widget/introduction">Widget Testing</a><li><a href="https://docs.flutter.dev/cookbook/testing/integration/introduction">Integration Testing</a></ul><p>In this article, we will see what unit testing is and how we can perform unit testing with some examples.</p><h2 id="table-of-contents"><span class="mr-2">Table of Contents</span><a href="#table-of-contents" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="#what-is-unit-testing-">What is unit testing? 🤔</a><li><a href="#mocks-and-fakes">Mocks and Fakes</a><li><a href="#implementation">Implementation</a><ul><li><a href="#test-1-file_1dart">Test 1 (file_1.dart)</a><li><a href="#test-2-file_2dart">Test 2 (file_2.dart)</a><li><a href="#test-3-file_3dart">Test 3 (file_3.dart)</a></ul><li><a href="#checking-code-coverage">Checking Code Coverage</a><li><a href="#conclusion">Conclusion</a><li><a href="#credit">Credit</a></ul><h2 id="what-is-unit-testing-"><span class="mr-2">What is unit testing? 🤔</span><a href="#what-is-unit-testing-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>According to the official <a href="https://docs.flutter.dev/cookbook/testing/unit/introduction">flutter documentation</a>, unit tests are handy for verifying the behavior of a single function, method, or class. This definition is simple and cut to the point. Let’s take an example where we have a function <code class="language-plaintext highlighter-rouge">addNumbers(int a, int b)</code>. As the name of the function suggests, the function is responsible to add two integers. Now, unit testing is written to be sure that if the two inputs are 5 and 10, then the output of the function should be 15. This is what the earlier definition meant by <code class="language-plaintext highlighter-rouge">verifying the behavior</code>.</p><h2 id="mocks-and-fakes"><span class="mr-2">Mocks and Fakes</span><a href="#mocks-and-fakes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Sometimes we might encounter a situation where our unit test depends on other classes. For example, an instance of some database, or some network client. Now, it isn’t ideal to use the real instances of such dependencies in our tests as using the real instances of such dependencies can slow down the test execution. Also, if we are dependent on some <code class="language-plaintext highlighter-rouge">InternetChecker</code> and if the internet service is not available then the test might not work as expected resulting into a <code class="language-plaintext highlighter-rouge">flaky test</code>. 💩 That’s why we use Mocks instead of real instances of dependencies. Using mocks, we can stub certain behavior so that the test runs as desired regardless of external factors.</p><blockquote class="prompt-info"><div><p><em>Stubbing refers to defining certain behavior ahead of time. For example, when x is called, return y. Here, we are giving instruction that when x is called, then y is to be returned. We will see Mocks in action in the later part of this blog.</em></p></div></blockquote><p>We use fakes in our test when we need to pass custom objects as parameters in our stubs or when we want to return some <em>Fake</em> version of any object. For example, in the statement <code class="language-plaintext highlighter-rouge">when x is called, return y</code>, if the signature of the method <code class="language-plaintext highlighter-rouge">x</code> is <code class="language-plaintext highlighter-rouge">void x(CustomObj a)</code>, then directly passing in an instance of <code class="language-plaintext highlighter-rouge">CustomObj</code> as parameter in our test won’t work. In that case, we create a <code class="language-plaintext highlighter-rouge">FakeCustomObj</code>. If the function accepts parameters of primitive type (int, double, etc), then Fakes are not required.</p><p>In our practical implementation, we will be using a package named <a href="https://pub.dev/packages/mocktail">mocktail</a> that helps in creating Mocks and Fakes very easily for us. 🤩</p><h2 id="implementation"><span class="mr-2">Implementation</span><a href="#implementation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now, it’s time to put everything into practice. We will perform testing for a very simple code first and gradually increase the complexity. First, let’s take a look at the folder structure that we will be following.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>📦root_dir       
    ├─ 📂lib       
    │  ├─ 📜file_1.dart
    │  ├─ 📜file_2.dart
    │  └─ 📜file_3.dart
    ├─ 📂test
    │  ├─ 📜file_1_test.dart
    │  ├─ 📜file_2_test.dart
    │  └─ 📜file_3_test.dart
    └─ 📜pubspec.yaml         
</pre></table></code></div></div><blockquote class="prompt-info"><div><p><em>Most of the codes that I will be testing in this blog are taken from some open-source projects.</em></p></div></blockquote><h3 id="test-1-file_1dart"><span class="mr-2">Test 1 (file_1.dart)</span><a href="#test-1-file_1dart" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Let’s take a look at the code that we’ll be testing.</p><div file="file_1.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="file_1.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">Calculator</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The code is fairly simple. The method accepts two integer parameters and returns their sum.</p><p>Like I said earlier, unit testing means verifying the behavior. So, if the inputs are 2 and 3, the output has to be 5. This is what needs to be tested.</p><p>Now, inside <code class="language-plaintext highlighter-rouge">file_1_test.dart</code>, add the following code to test it.</p><div file="file_1_test.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="file_1_test.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="s">'package:test/test.dart'</span><span class="o">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">calculator</span> <span class="o">=</span> <span class="n">Calculator</span><span class="p">();</span>

  <span class="n">test</span><span class="p">(</span>
    <span class="s">'should return the sum of two inputs'</span><span class="p">,</span>
    <span class="p">()</span> <span class="p">{</span>
      <span class="kd">final</span> <span class="n">result</span> <span class="o">=</span> <span class="n">calculator</span><span class="o">.</span><span class="na">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// act</span>

      <span class="n">expect</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// assert</span>
    <span class="p">},</span>
  <span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>As you can see, the testing process begins with a <code class="language-plaintext highlighter-rouge">test</code> function. This function takes two arguments: a string that is used to describe what this test does and a callback function inside which we write our test. The actual method which is to be tested is called from the <code class="language-plaintext highlighter-rouge">test()</code> function. Then, the result is matched against an expected value. If the result and the expected value (in our case 3) matches, the test passes else the test fails.</p><p>In order to run the test, go to your terminal and run</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>flutter <span class="nb">test</span>
</pre></table></code></div></div><blockquote class="prompt-tip"><div><p><em>It is important to add <code class="language-plaintext highlighter-rouge">_test</code> suffix to the file name that represents test code. Also, make sure to be on the project’s root directory in your terminal when the command <code class="language-plaintext highlighter-rouge">flutter test</code> is ran.</em></p></div></blockquote><h3 id="test-2-file_2dart"><span class="mr-2">Test 2 (file_2.dart)</span><a href="#test-2-file_2dart" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Let’s take a look at the code that we’ll be testing.</p><div file="file_2.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="file_2.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">AllowList</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="kt">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">_list</span><span class="p">;</span>

  <span class="kt">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="kd">get</span> <span class="n">list</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">_list</span><span class="p">;</span>

  <span class="n">AllowList</span><span class="p">(</span><span class="k">this</span><span class="o">.</span><span class="na">_list</span><span class="p">);</span>

  <span class="kt">String</span> <span class="n">getDescription</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">'Value must of one of (</span><span class="si">${_list.join(", ")}</span><span class="s">)'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">String</span> <span class="n">getType</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">T</span><span class="o">.</span><span class="na">toString</span><span class="p">();</span>
  <span class="p">}</span>
</pre></table></code></div></div><p>Now let’s think what are the characteristics that can be tested in this code? 🤔💭</p><ol><li>The getter <code class="language-plaintext highlighter-rouge">list</code> should return the actual list passed in the constructor parameter.<li>The method <code class="language-plaintext highlighter-rouge">getDescription()</code> should return a string statement.<li>The method <code class="language-plaintext highlighter-rouge">getType()</code> should return the data type of the elements of the list.</ol><p>Now, that we know what are to be tested. Let’s see the test code.</p><div file="file_2_test.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="file_2_test.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="s">'package:test/test.dart'</span><span class="o">;</span>
<span class="c1">// Add other necessary imports</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">intList</span> <span class="o">=</span> <span class="n">AllowList</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
  <span class="kd">final</span> <span class="n">floatingList</span> <span class="o">=</span> <span class="n">AllowList</span><span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]);</span>
  <span class="kd">final</span> <span class="n">stringList</span> <span class="o">=</span> <span class="n">AllowList</span><span class="p">&lt;</span><span class="kt">String</span><span class="p">&gt;([</span><span class="s">'a'</span><span class="p">,</span> <span class="s">'b'</span><span class="p">,</span> <span class="s">'c'</span><span class="p">]);</span>
  <span class="kd">final</span> <span class="n">nullableIntList</span> <span class="o">=</span> <span class="n">AllowList</span><span class="p">&lt;</span><span class="kt">int</span><span class="o">?</span><span class="p">&gt;([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">null</span><span class="p">]);</span>

  <span class="kt">String</span> <span class="n">stringReturningFunction</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="kt">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">myList</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span>
      <span class="s">'Value must of one of (</span><span class="si">${myList.join(", ")}</span><span class="s">)'</span><span class="p">;</span>

  <span class="n">group</span><span class="p">(</span>
    <span class="s">'allow_list_test'</span><span class="p">,</span>
    <span class="p">()</span> <span class="p">{</span>
      <span class="n">test</span><span class="p">(</span>
        <span class="s">'list getter should return list value'</span><span class="p">,</span>
        <span class="p">()</span> <span class="p">{</span>
          <span class="n">expect</span><span class="p">(</span><span class="n">intList</span><span class="o">.</span><span class="na">list</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
          <span class="n">expect</span><span class="p">(</span><span class="n">floatingList</span><span class="o">.</span><span class="na">list</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]);</span>
          <span class="n">expect</span><span class="p">(</span><span class="n">stringList</span><span class="o">.</span><span class="na">list</span><span class="p">,</span> <span class="p">[</span><span class="s">'a'</span><span class="p">,</span> <span class="s">'b'</span><span class="p">,</span> <span class="s">'c'</span><span class="p">]);</span>
          <span class="n">expect</span><span class="p">(</span><span class="n">nullableIntList</span><span class="o">.</span><span class="na">list</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">null</span><span class="p">]);</span>
        <span class="p">},</span>
      <span class="p">);</span>

      <span class="n">test</span><span class="p">(</span>
        <span class="s">'getDescription: should return proper description'</span><span class="p">,</span>
        <span class="p">()</span> <span class="p">{</span>
          <span class="n">expect</span><span class="p">(</span>
            <span class="n">intList</span><span class="o">.</span><span class="na">getDescription</span><span class="p">(),</span>
            <span class="n">stringReturningFunction</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span>
          <span class="p">);</span>
          <span class="n">expect</span><span class="p">(</span>
            <span class="n">floatingList</span><span class="o">.</span><span class="na">getDescription</span><span class="p">(),</span>
            <span class="n">stringReturningFunction</span><span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]),</span>
          <span class="p">);</span>
          <span class="n">expect</span><span class="p">(</span>
            <span class="n">stringList</span><span class="o">.</span><span class="na">getDescription</span><span class="p">(),</span>
            <span class="n">stringReturningFunction</span><span class="p">&lt;</span><span class="kt">String</span><span class="p">&gt;([</span><span class="s">'a'</span><span class="p">,</span> <span class="s">'b'</span><span class="p">,</span> <span class="s">'c'</span><span class="p">]),</span>
          <span class="p">);</span>
          <span class="n">expect</span><span class="p">(</span>
            <span class="n">nullableIntList</span><span class="o">.</span><span class="na">getDescription</span><span class="p">(),</span>
            <span class="n">stringReturningFunction</span><span class="p">&lt;</span><span class="kt">int</span><span class="o">?</span><span class="p">&gt;([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">null</span><span class="p">]),</span>
          <span class="p">);</span>
        <span class="p">},</span>
      <span class="p">);</span>

      <span class="n">test</span><span class="p">(</span>
        <span class="s">'getType(): should return proper data type'</span><span class="p">,</span>
        <span class="p">()</span> <span class="p">{</span>
          <span class="n">expect</span><span class="p">(</span><span class="n">intList</span><span class="o">.</span><span class="na">getType</span><span class="p">(),</span> <span class="s">'int'</span><span class="p">);</span>
          <span class="n">expect</span><span class="p">(</span><span class="n">floatingList</span><span class="o">.</span><span class="na">getType</span><span class="p">(),</span> <span class="s">'double'</span><span class="p">);</span>
          <span class="n">expect</span><span class="p">(</span><span class="n">stringList</span><span class="o">.</span><span class="na">getType</span><span class="p">(),</span> <span class="s">'String'</span><span class="p">);</span>
          <span class="n">expect</span><span class="p">(</span><span class="n">nullableIntList</span><span class="o">.</span><span class="na">getType</span><span class="p">(),</span> <span class="s">'int?'</span><span class="p">);</span>
        <span class="p">},</span>
      <span class="p">);</span>
    <span class="p">},</span>
  <span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Now, run the test using the command <code class="language-plaintext highlighter-rouge">flutter test</code> and the test should pass. I used a new term here named <code class="language-plaintext highlighter-rouge">group</code>. A <code class="language-plaintext highlighter-rouge">group</code> is basically where you’d place relevant tests together.</p><blockquote class="prompt-tip"><div><p><em>Notice that I have created four different instances of <code class="language-plaintext highlighter-rouge">AllowList</code> class in the above test. The test would have passed with just one to be honest. But the fact that <code class="language-plaintext highlighter-rouge">AllowList</code> accepts generic constructor parameter, it becomes our duty as a developer to test against different cases.</em></p></div></blockquote><h3 id="test-3-file_3dart"><span class="mr-2">Test 3 (file_3.dart)</span><a href="#test-3-file_3dart" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Now, let’s try testing a more difficult code. This is going to be the last code we’ll be testing in this blog. The code we will be testing looks like this.</p><div file="file_3.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="file_3.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
</pre><td class="rouge-code"><pre><span class="kd">typedef</span> <span class="n">InnerClient</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="na">Client</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">KhaltiHttpClient</span> <span class="kd">extends</span> <span class="n">KhaltiClient</span> <span class="p">{</span>
  <span class="n">KhaltiHttpClient</span><span class="p">({</span>
    <span class="n">InnerClient</span><span class="o">?</span> <span class="n">client</span><span class="p">,</span>
  <span class="p">})</span> <span class="o">:</span> <span class="n">_client</span> <span class="o">=</span> <span class="n">client</span> <span class="o">??</span> <span class="n">InnerClient</span><span class="p">();</span>

  <span class="kd">final</span> <span class="n">InnerClient</span> <span class="n">_client</span><span class="p">;</span>

  <span class="nd">@override</span>
  <span class="n">Future</span><span class="p">&lt;</span><span class="n">HttpResponse</span><span class="p">&gt;</span> <span class="kd">get</span><span class="p">(</span>
    <span class="kt">String</span> <span class="n">url</span><span class="p">,</span>
    <span class="kt">Map</span><span class="p">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Object</span><span class="p">&gt;</span> <span class="n">params</span><span class="p">,</span>
  <span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">_handleExceptions</span><span class="p">(</span>
      <span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
        <span class="kd">final</span> <span class="n">uri</span> <span class="o">=</span> <span class="kt">Uri</span><span class="o">.</span><span class="na">parse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="na">replace</span><span class="p">(</span><span class="nl">queryParameters:</span> <span class="n">params</span><span class="p">);</span>
        <span class="kd">final</span> <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">_client</span><span class="o">.</span><span class="na">get</span><span class="p">(</span>
          <span class="n">uri</span><span class="p">,</span>
          <span class="nl">headers:</span> <span class="n">KhaltiService</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">raw</span><span class="p">,</span>
        <span class="p">);</span>
        <span class="kd">final</span> <span class="n">statusCode</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">statusCode</span><span class="p">;</span>
        <span class="kd">final</span> <span class="n">responseData</span> <span class="o">=</span> <span class="n">jsonDecode</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">_isStatusValid</span><span class="p">(</span><span class="n">statusCode</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="n">HttpResponse</span><span class="o">.</span><span class="na">success</span><span class="p">(</span>
            <span class="nl">data:</span> <span class="n">responseData</span><span class="p">,</span>
            <span class="nl">statusCode:</span> <span class="n">statusCode</span><span class="p">,</span>
          <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="o">.</span><span class="na">failure</span><span class="p">(</span>
          <span class="nl">data:</span> <span class="n">responseData</span><span class="p">,</span>
          <span class="nl">statusCode:</span> <span class="n">statusCode</span><span class="p">,</span>
        <span class="p">);</span>
      <span class="p">},</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="nd">@override</span>
  <span class="n">Future</span><span class="p">&lt;</span><span class="n">HttpResponse</span><span class="p">&gt;</span> <span class="n">post</span><span class="p">(</span>
    <span class="kt">String</span> <span class="n">url</span><span class="p">,</span>
    <span class="kt">Map</span><span class="p">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Object</span><span class="o">?</span><span class="p">&gt;</span> <span class="n">data</span><span class="p">,</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">_handleExceptions</span><span class="p">(</span>
      <span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
        <span class="kd">final</span> <span class="n">uri</span> <span class="o">=</span> <span class="kt">Uri</span><span class="o">.</span><span class="na">parse</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
        <span class="kd">final</span> <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">_client</span><span class="o">.</span><span class="na">post</span><span class="p">(</span>
          <span class="n">uri</span><span class="p">,</span>
          <span class="nl">body:</span> <span class="n">data</span><span class="p">,</span>
          <span class="nl">headers:</span> <span class="n">KhaltiService</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">raw</span><span class="p">,</span>
        <span class="p">);</span>
        <span class="kd">final</span> <span class="n">statusCode</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">statusCode</span><span class="p">;</span>
        <span class="kd">final</span> <span class="n">responseData</span> <span class="o">=</span> <span class="n">jsonDecode</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">_isStatusValid</span><span class="p">(</span><span class="n">statusCode</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="n">HttpResponse</span><span class="o">.</span><span class="na">success</span><span class="p">(</span>
            <span class="nl">data:</span> <span class="n">responseData</span><span class="p">,</span>
            <span class="nl">statusCode:</span> <span class="n">statusCode</span><span class="p">,</span>
          <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="o">.</span><span class="na">failure</span><span class="p">(</span>
          <span class="nl">data:</span> <span class="n">responseData</span><span class="p">,</span>
          <span class="nl">statusCode:</span> <span class="n">statusCode</span><span class="p">,</span>
        <span class="p">);</span>
      <span class="p">},</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="kt">bool</span> <span class="n">_isStatusValid</span><span class="p">(</span><span class="kt">int</span> <span class="n">statusCode</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">statusCode</span> <span class="p">&gt;</span><span class="o">=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">statusCode</span> <span class="p">&lt;</span> <span class="mi">300</span><span class="p">;</span>

  <span class="n">Future</span><span class="p">&lt;</span><span class="n">HttpResponse</span><span class="p">&gt;</span> <span class="n">_handleExceptions</span><span class="p">(</span>
    <span class="n">Future</span><span class="p">&lt;</span><span class="n">HttpResponse</span><span class="p">&gt;</span> <span class="kt">Function</span><span class="p">()</span> <span class="n">caller</span><span class="p">,</span>
  <span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">await</span> <span class="n">caller</span><span class="p">();</span>
    <span class="p">}</span> <span class="kd">on</span> <span class="n">HttpException</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">HttpResponse</span><span class="o">.</span><span class="na">exception</span><span class="p">(</span>
        <span class="nl">message:</span> <span class="n">e</span><span class="o">.</span><span class="na">message</span><span class="p">,</span>
        <span class="nl">code:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nl">stackTrace:</span> <span class="n">s</span><span class="p">,</span>
        <span class="nl">detail:</span> <span class="n">e</span><span class="o">.</span><span class="na">uri</span><span class="p">,</span>
      <span class="p">);</span>
    <span class="p">}</span> <span class="kd">on</span> <span class="n">http</span><span class="o">.</span><span class="na">ClientException</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">HttpResponse</span><span class="o">.</span><span class="na">exception</span><span class="p">(</span>
        <span class="nl">message:</span> <span class="n">e</span><span class="o">.</span><span class="na">message</span><span class="p">,</span>
        <span class="nl">code:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nl">stackTrace:</span> <span class="n">s</span><span class="p">,</span>
        <span class="nl">detail:</span> <span class="n">e</span><span class="o">.</span><span class="na">uri</span><span class="p">,</span>
      <span class="p">);</span>
    <span class="p">}</span> <span class="kd">on</span> <span class="n">SocketException</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">HttpResponse</span><span class="o">.</span><span class="na">exception</span><span class="p">(</span>
        <span class="nl">message:</span> <span class="n">e</span><span class="o">.</span><span class="na">message</span><span class="p">,</span>
        <span class="nl">code:</span> <span class="n">e</span><span class="o">.</span><span class="na">osError</span><span class="o">?.</span><span class="na">errorCode</span> <span class="o">??</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nl">stackTrace:</span> <span class="n">s</span><span class="p">,</span>
        <span class="nl">detail:</span> <span class="n">e</span><span class="o">.</span><span class="na">osError</span><span class="o">?.</span><span class="na">message</span><span class="p">,</span>
        <span class="nl">isSocketException:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="p">);</span>
    <span class="p">}</span> <span class="kd">on</span> <span class="n">FormatException</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">HttpResponse</span><span class="o">.</span><span class="na">exception</span><span class="p">(</span>
        <span class="nl">message:</span> <span class="n">e</span><span class="o">.</span><span class="na">message</span><span class="p">,</span>
        <span class="nl">code:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nl">stackTrace:</span> <span class="n">s</span><span class="p">,</span>
        <span class="nl">detail:</span> <span class="n">e</span><span class="o">.</span><span class="na">source</span><span class="p">,</span>
      <span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">HttpResponse</span><span class="o">.</span><span class="na">exception</span><span class="p">(</span>
        <span class="nl">message:</span> <span class="n">e</span><span class="o">.</span><span class="na">toString</span><span class="p">(),</span>
        <span class="nl">code:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nl">stackTrace:</span> <span class="n">s</span><span class="p">,</span>
      <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Let’s first understand what this code does in detail before discussing about its test.</p><p>We have a class <code class="language-plaintext highlighter-rouge">KhaltiHttpClient</code> that depends on <code class="language-plaintext highlighter-rouge">http.Client</code>. <code class="language-plaintext highlighter-rouge">http.Client</code>’s instance is necessary to make network requests internally. We have two public methods: <code class="language-plaintext highlighter-rouge">get()</code> and <code class="language-plaintext highlighter-rouge">post()</code>. Both methods <code class="language-plaintext highlighter-rouge">get()</code> and <code class="language-plaintext highlighter-rouge">post()</code> make some network calls. This operation is wrapped within a <code class="language-plaintext highlighter-rouge">try-catch</code> block inside <code class="language-plaintext highlighter-rouge">_handleExceptions()</code> method.</p><p>Now, if we were to test this class, what are the different scenarios we will have to test? 🤔💭 Let’s list that out one by one.</p><ul><li>An instance of <code class="language-plaintext highlighter-rouge">InnerClient</code> should be instantiated when nothing is passed as a parameter in the <code class="language-plaintext highlighter-rouge">KhaltiHttpClient</code> constructor.<li>The <code class="language-plaintext highlighter-rouge">get()</code> method:<ul><li>should return <code class="language-plaintext highlighter-rouge">HttpResponse.success()</code> if the status code is &gt;= 200 and &lt; 300.<li>should return <code class="language-plaintext highlighter-rouge">HttpResponse.failure()</code> if the status code is &gt;= 400 and &lt;600.<li>should return <code class="language-plaintext highlighter-rouge">HttpResponse.exception()</code> if <code class="language-plaintext highlighter-rouge">HttpException</code> is thrown.<li>should return <code class="language-plaintext highlighter-rouge">HttpResponse.exception()</code> if <code class="language-plaintext highlighter-rouge">ClientException</code> is thrown.<li>should return <code class="language-plaintext highlighter-rouge">HttpResponse.exception()</code> if <code class="language-plaintext highlighter-rouge">SocketException</code> is thrown.<li>should return <code class="language-plaintext highlighter-rouge">HttpResponse.exception()</code> if <code class="language-plaintext highlighter-rouge">FormatException</code> is thrown.<li>should return <code class="language-plaintext highlighter-rouge">HttpResponse.exception()</code> if any Exception is thrown.</ul><li>The <code class="language-plaintext highlighter-rouge">post()</code> method:<ul><li>should return <code class="language-plaintext highlighter-rouge">HttpResponse.success()</code> if the status code is &gt;= 200 and &lt; 300.<li>should return <code class="language-plaintext highlighter-rouge">HttpResponse.failure()</code> if the status code is &gt;= 400 and &lt;600.<li>should return <code class="language-plaintext highlighter-rouge">HttpResponse.exception()</code> if <code class="language-plaintext highlighter-rouge">HttpException</code> is thrown.<li>should return <code class="language-plaintext highlighter-rouge">HttpResponse.exception()</code> if <code class="language-plaintext highlighter-rouge">ClientException</code> is thrown.<li>should return <code class="language-plaintext highlighter-rouge">HttpResponse.exception()</code> if <code class="language-plaintext highlighter-rouge">SocketException</code> is thrown.<li>should return <code class="language-plaintext highlighter-rouge">HttpResponse.exception()</code> if <code class="language-plaintext highlighter-rouge">FormatException</code> is thrown.<li>should return <code class="language-plaintext highlighter-rouge">HttpResponse.exception()</code> if any Exception is thrown.</ul></ul><p>It might seem like a lot of work and troublesome but this is what unit testing is all about. You don’t want to miss a single scenario from being tested.</p><p>If you are thinking what <code class="language-plaintext highlighter-rouge">HttpResponse</code> class is, then this is what this class looks like.</p><div file="http_response.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="http_response.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
</pre><td class="rouge-code"><pre><span class="c1">/// The response for [KhaltiClient].</span>
<span class="kd">class</span> <span class="nc">HttpResponse</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="n">HttpResponse</span><span class="o">.</span><span class="na">_</span><span class="p">({</span><span class="k">this</span><span class="o">.</span><span class="na">data</span><span class="p">,</span> <span class="k">this</span><span class="o">.</span><span class="na">statusCode</span><span class="p">,</span> <span class="k">this</span><span class="o">.</span><span class="na">message</span><span class="p">});</span>

  <span class="c1">/// The [data] received.</span>
  <span class="kd">final</span> <span class="kt">Object</span><span class="o">?</span> <span class="n">data</span><span class="p">;</span>

  <span class="c1">/// The [statusCode] of response.</span>
  <span class="kd">final</span> <span class="kt">int</span><span class="o">?</span> <span class="n">statusCode</span><span class="p">;</span>

  <span class="c1">/// The error [message].</span>
  <span class="kd">final</span> <span class="kt">String</span><span class="o">?</span> <span class="n">message</span><span class="p">;</span>

  <span class="c1">/// Factory for [SuccessHttpResponse].</span>
  <span class="kd">factory</span> <span class="n">HttpResponse</span><span class="o">.</span><span class="na">success</span><span class="p">({</span>
    <span class="kd">required</span> <span class="kt">Object</span> <span class="n">data</span><span class="p">,</span>
    <span class="kd">required</span> <span class="kt">int</span> <span class="n">statusCode</span><span class="p">,</span>
  <span class="p">})</span> <span class="o">=</span> <span class="n">SuccessHttpResponse</span><span class="o">.</span><span class="na">_</span><span class="p">;</span>

  <span class="c1">/// Factory for [FailureHttpResponse].</span>
  <span class="kd">factory</span> <span class="n">HttpResponse</span><span class="o">.</span><span class="na">failure</span><span class="p">({</span>
    <span class="kd">required</span> <span class="kt">Object</span> <span class="n">data</span><span class="p">,</span>
    <span class="kd">required</span> <span class="kt">int</span> <span class="n">statusCode</span><span class="p">,</span>
  <span class="p">})</span> <span class="o">=</span> <span class="n">FailureHttpResponse</span><span class="o">.</span><span class="na">_</span><span class="p">;</span>

  <span class="c1">/// Factory for [ExceptionHttpResponse].</span>
  <span class="kd">factory</span> <span class="n">HttpResponse</span><span class="o">.</span><span class="na">exception</span><span class="p">({</span>
    <span class="kd">required</span> <span class="kt">String</span> <span class="n">message</span><span class="p">,</span>
    <span class="kd">required</span> <span class="kt">int</span> <span class="n">code</span><span class="p">,</span>
    <span class="kd">required</span> <span class="n">StackTrace</span> <span class="n">stackTrace</span><span class="p">,</span>
    <span class="kt">Object</span><span class="o">?</span> <span class="n">detail</span><span class="p">,</span>
    <span class="kt">bool</span> <span class="n">isSocketException</span><span class="p">,</span>
  <span class="p">})</span> <span class="o">=</span> <span class="n">ExceptionHttpResponse</span><span class="o">.</span><span class="na">_</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">/// The success response for [KhaltiClient].</span>
<span class="kd">class</span> <span class="nc">SuccessHttpResponse</span> <span class="kd">extends</span> <span class="n">HttpResponse</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="n">SuccessHttpResponse</span><span class="o">.</span><span class="na">_</span><span class="p">({</span>
    <span class="kd">required</span> <span class="kt">Object</span> <span class="n">data</span><span class="p">,</span>
    <span class="kd">required</span> <span class="kt">int</span> <span class="n">statusCode</span><span class="p">,</span>
  <span class="p">})</span> <span class="o">:</span> <span class="k">super</span><span class="o">.</span><span class="na">_</span><span class="p">(</span><span class="nl">data:</span> <span class="n">data</span><span class="p">,</span> <span class="nl">statusCode:</span> <span class="n">statusCode</span><span class="p">);</span>

  <span class="nd">@override</span>
  <span class="kt">String</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">'SuccessHttpResponse{data: </span><span class="si">$data</span><span class="s">, statusCode: </span><span class="si">$statusCode</span><span class="s">}'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">/// The failure response for [KhaltiClient].</span>
<span class="kd">class</span> <span class="nc">FailureHttpResponse</span> <span class="kd">extends</span> <span class="n">HttpResponse</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="n">FailureHttpResponse</span><span class="o">.</span><span class="na">_</span><span class="p">({</span>
    <span class="kd">required</span> <span class="kt">Object</span> <span class="n">data</span><span class="p">,</span>
    <span class="kd">required</span> <span class="kt">int</span> <span class="n">statusCode</span><span class="p">,</span>
  <span class="p">})</span> <span class="o">:</span> <span class="k">super</span><span class="o">.</span><span class="na">_</span><span class="p">(</span><span class="nl">data:</span> <span class="n">data</span><span class="p">,</span> <span class="nl">statusCode:</span> <span class="n">statusCode</span><span class="p">);</span>

  <span class="nd">@override</span>
  <span class="kt">String</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">'FailureHttpResponse{data: </span><span class="si">$data</span><span class="s">, statusCode: </span><span class="si">$statusCode</span><span class="s">}'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">/// The exception for [KhaltiClient].</span>
<span class="kd">class</span> <span class="nc">ExceptionHttpResponse</span> <span class="kd">extends</span> <span class="n">HttpResponse</span> <span class="p">{</span>
  <span class="c1">/// The error [code].</span>
  <span class="kd">final</span> <span class="kt">int</span> <span class="n">code</span><span class="p">;</span>

  <span class="c1">/// The [stackTrace] of the exception.</span>
  <span class="kd">final</span> <span class="n">StackTrace</span> <span class="n">stackTrace</span><span class="p">;</span>

  <span class="c1">/// The exception detail</span>
  <span class="kd">final</span> <span class="kt">Object</span><span class="o">?</span> <span class="n">detail</span><span class="p">;</span>

  <span class="c1">/// Defines whether the exception is socket exception or not.</span>
  <span class="kd">final</span> <span class="kt">bool</span> <span class="n">isSocketException</span><span class="p">;</span>

  <span class="kd">const</span> <span class="n">ExceptionHttpResponse</span><span class="o">.</span><span class="na">_</span><span class="p">({</span>
    <span class="kd">required</span> <span class="kt">String</span> <span class="n">message</span><span class="p">,</span>
    <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">code</span><span class="p">,</span>
    <span class="kd">required</span> <span class="k">this</span><span class="o">.</span><span class="na">stackTrace</span><span class="p">,</span>
    <span class="k">this</span><span class="o">.</span><span class="na">detail</span><span class="p">,</span>
    <span class="k">this</span><span class="o">.</span><span class="na">isSocketException</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
  <span class="p">})</span> <span class="o">:</span> <span class="k">super</span><span class="o">.</span><span class="na">_</span><span class="p">(</span><span class="nl">message:</span> <span class="n">message</span><span class="p">,</span> <span class="nl">statusCode:</span> <span class="n">code</span><span class="p">);</span>

  <span class="nd">@override</span>
  <span class="kt">String</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">'ExceptionHttpResponse{message: </span><span class="si">$message</span><span class="s">, code: </span><span class="si">$code</span><span class="s">, stackTrace: </span><span class="si">$stackTrace</span><span class="s">, detail: </span><span class="si">$detail</span><span class="s">, isSocketException: </span><span class="si">$isSocketException</span><span class="s">}'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>And this is its unit test.</p><div file="http_response_test.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="http_response_test.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">group</span><span class="p">(</span><span class="s">'HttpResponse tests | '</span><span class="p">,</span> <span class="p">()</span> <span class="p">{</span>
    <span class="n">test</span><span class="p">(</span><span class="s">'success factory'</span><span class="p">,</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">final</span> <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="o">.</span><span class="na">success</span><span class="p">(</span>
        <span class="nl">data:</span> <span class="s">'data'</span><span class="p">,</span>
        <span class="nl">statusCode:</span> <span class="mi">200</span><span class="p">,</span>
      <span class="p">);</span>

      <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">isA</span><span class="p">&lt;</span><span class="n">SuccessHttpResponse</span><span class="p">&gt;());</span>
      <span class="n">expect</span><span class="p">(</span>
        <span class="n">response</span><span class="o">.</span><span class="na">toString</span><span class="p">(),</span>
        <span class="s">'SuccessHttpResponse{data: data, statusCode: 200}'</span><span class="p">,</span>
      <span class="p">);</span>
    <span class="p">});</span>

    <span class="n">test</span><span class="p">(</span><span class="s">'failure factory'</span><span class="p">,</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">final</span> <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="o">.</span><span class="na">failure</span><span class="p">(</span>
        <span class="nl">data:</span> <span class="s">'Unauthorized'</span><span class="p">,</span>
        <span class="nl">statusCode:</span> <span class="mi">403</span><span class="p">,</span>
      <span class="p">);</span>

      <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">isA</span><span class="p">&lt;</span><span class="n">FailureHttpResponse</span><span class="p">&gt;());</span>
      <span class="n">expect</span><span class="p">(</span>
        <span class="n">response</span><span class="o">.</span><span class="na">toString</span><span class="p">(),</span>
        <span class="s">'FailureHttpResponse{data: Unauthorized, statusCode: 403}'</span><span class="p">,</span>
      <span class="p">);</span>
    <span class="p">});</span>

    <span class="n">test</span><span class="p">(</span><span class="s">'exception factory'</span><span class="p">,</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">final</span> <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="o">.</span><span class="na">exception</span><span class="p">(</span>
        <span class="nl">message:</span> <span class="s">'No connection'</span><span class="p">,</span>
        <span class="nl">code:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="nl">stackTrace:</span> <span class="n">StackTrace</span><span class="o">.</span><span class="na">empty</span><span class="p">,</span>
        <span class="nl">detail:</span> <span class="s">'Could not reach the server'</span><span class="p">,</span>
        <span class="nl">isSocketException:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="p">);</span>

      <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">isA</span><span class="p">&lt;</span><span class="n">ExceptionHttpResponse</span><span class="p">&gt;());</span>
      <span class="n">expect</span><span class="p">(</span>
        <span class="n">response</span><span class="o">.</span><span class="na">toString</span><span class="p">(),</span>
        <span class="s">'ExceptionHttpResponse{message: No connection, code: 7, stackTrace: , detail: Could not reach the server, isSocketException: true}'</span><span class="p">,</span>
      <span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Since, the test for <code class="language-plaintext highlighter-rouge">HttpResponse</code> is pretty simple, I won’t be explaining it here.</p><p>Now, let’s begin writing our test for <code class="language-plaintext highlighter-rouge">KhaltiHttpClient</code>.</p><ul><li>should instantiate internal <code class="language-plaintext highlighter-rouge">http.Client</code> when not injected via <code class="language-plaintext highlighter-rouge">KhaltiHttpClient</code> constructor.</ul><div class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="Dart"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="n">group</span><span class="p">(</span>
    <span class="s">'KhaltiHttpClient constructor'</span><span class="p">,</span>
    <span class="p">()</span> <span class="p">{</span>
      <span class="n">test</span><span class="p">(</span>
        <span class="s">'instantiates internal httpClient when not injected'</span><span class="p">,</span>
        <span class="p">()</span> <span class="p">{</span>
          <span class="n">expect</span><span class="p">(</span><span class="n">KhaltiHttpClient</span><span class="p">(),</span> <span class="n">isNotNull</span><span class="p">);</span>
        <span class="p">},</span>
      <span class="p">);</span>
    <span class="p">},</span>
  <span class="p">);</span>
</pre></table></code></div></div><p>This is all we need to do to test this behavior as initializing <code class="language-plaintext highlighter-rouge">KhaltiHttpClient()</code> will 101% initialize the internal <code class="language-plaintext highlighter-rouge">http.Client</code>. If you run this test using the command <code class="language-plaintext highlighter-rouge">flutter test</code>, you will see that the test will pass.</p><p>Now, let’s test for the <code class="language-plaintext highlighter-rouge">get()</code> method which is a bit tricky as few things that we haven’t implemented yet are involved such as <code class="language-plaintext highlighter-rouge">Mocks</code> and <code class="language-plaintext highlighter-rouge">Fakes</code>.</p><p>If we see the <code class="language-plaintext highlighter-rouge">get()</code> method in the <code class="language-plaintext highlighter-rouge">KhaltiHttpClient</code>, the method internally uses <code class="language-plaintext highlighter-rouge">http.Client</code>’s instance to make network requests. The line</p><div class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="Dart"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">final</span> <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">_client</span><span class="o">.</span><span class="na">get</span><span class="p">(</span>
  <span class="n">uri</span><span class="p">,</span>
  <span class="nl">headers:</span> <span class="n">KhaltiService</span><span class="o">.</span><span class="na">config</span><span class="o">.</span><span class="na">raw</span><span class="p">,</span>
<span class="p">);</span>
</pre></table></code></div></div><p>is what makes the request to the server. This line is also prone to several exceptions so we need to write our test in such a way that this method doesn’t throw any exceptions. But how can we determine how an external package works? The thing is we can’t.</p><p>We will be testing for a scenario that the <code class="language-plaintext highlighter-rouge">get()</code> method should return <code class="language-plaintext highlighter-rouge">HttpResponse.success()</code> if the status code is &gt;= 200 and &lt; 300. And in order to return <code class="language-plaintext highlighter-rouge">HttpResponse.success()</code>, the <code class="language-plaintext highlighter-rouge">_client.get()</code> has to return proper data.</p><p>Since, we can’t rely on the real class’ instance for the reasons I had stated <a href="https://biplabdutta.com.np/posts/unit-test/#mocks-and-fakes">above</a>, we create a mocked version of <code class="language-plaintext highlighter-rouge">http.Client</code>. And then we will call <code class="language-plaintext highlighter-rouge">_client.get()</code> from out mocked instance of <code class="language-plaintext highlighter-rouge">http.Client</code>.</p><p>We need to add a package <a href="https://pub.dev/packages/mocktail">mocktail</a> to our <code class="language-plaintext highlighter-rouge">dev_dependencies</code> inside <code class="language-plaintext highlighter-rouge">pubspec.yaml</code> file.</p><p>The way we create our Mock is by a simple one-liner.</p><div class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="Dart"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">_MockClient</span> <span class="kd">extends</span> <span class="n">Mock</span> <span class="kd">implements</span> <span class="n">http</span><span class="o">.</span><span class="na">Client</span> <span class="p">{}</span>
</pre></table></code></div></div><p>That’s it. Now, we can use <code class="language-plaintext highlighter-rouge">_MockClient</code> as regular <code class="language-plaintext highlighter-rouge">http.Client</code> such as</p><div class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="Dart"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">final</span> <span class="n">mockClient</span> <span class="o">=</span> <span class="n">_MockClient</span><span class="p">();</span>
<span class="c1">// We can now do </span>
<span class="c1">// mockClient.get(...) or mockClient.post(...)</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">mockClient.get()</code> will return an instance of <code class="language-plaintext highlighter-rouge">http.Response()</code> which is again part of the <a href="https://pub.dev/packages/http">http</a> library.</p><p>So, we create a mocked version of <code class="language-plaintext highlighter-rouge">http.Response</code> too.</p><div class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="Dart"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">_MockResponse</span> <span class="kd">extends</span> <span class="n">Mock</span> <span class="kd">implements</span> <span class="n">http</span><span class="o">.</span><span class="na">Response</span> <span class="p">{}</span>
</pre></table></code></div></div><p>The <code class="language-plaintext highlighter-rouge">mockClient.get()</code> takes in two arguments as its parameter: an Uri object and a Map.</p><p>Because an <code class="language-plaintext highlighter-rouge">Uri</code> object isn’t dart primitive type and is used as a parameter, we will need to create a <code class="language-plaintext highlighter-rouge">_FakeUri</code> so that it can be used.</p><div class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="Dart"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">_FakeUri</span> <span class="kd">extends</span> <span class="n">Fake</span> <span class="kd">implements</span> <span class="kt">Uri</span> <span class="p">{}</span>
</pre></table></code></div></div><p>And inside the <code class="language-plaintext highlighter-rouge">main</code> function in the test, add this line.</p><div class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="Dart"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre> <span class="n">setUpAll</span><span class="p">(()</span> <span class="p">{</span>
    <span class="n">registerFallbackValue</span><span class="p">(</span><span class="n">_FakeUri</span><span class="p">());</span>
  <span class="p">});</span>
</pre></table></code></div></div><p>Now, we are ready to write our test. We will write our test in <code class="language-plaintext highlighter-rouge">AAA</code> format which stands for <code class="language-plaintext highlighter-rouge">Arrange, Act, Assert</code>.</p><p><code class="language-plaintext highlighter-rouge">Arrange</code> is where we stub certain behavior. <code class="language-plaintext highlighter-rouge">Act</code> is where we call our methods that we need to test. <code class="language-plaintext highlighter-rouge">Assert</code> is where we perform out <code class="language-plaintext highlighter-rouge">expect</code> or <code class="language-plaintext highlighter-rouge">verify</code> block.</p><p>Because, we are expecting our <code class="language-plaintext highlighter-rouge">get()</code> to return <code class="language-plaintext highlighter-rouge">HttpResponse.success()</code>, our <code class="language-plaintext highlighter-rouge">mockClient.get()</code> should return a response with a status code of 200 (which refers to successful network request) and this is something we explicitly need to mention (the arrange phase aka stubbing).</p><div class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="Dart"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="n">_testUrl</span> <span class="o">=</span> <span class="s">'www.url.com'</span><span class="p">;</span>
<span class="kd">const</span> <span class="n">_testParams</span> <span class="o">=</span> <span class="p">{</span><span class="s">'key'</span><span class="o">:</span> <span class="s">'value'</span><span class="p">};</span>
<span class="kd">const</span> <span class="n">_testResponseBody</span> <span class="o">=</span> <span class="s">'{"message": "Fake Response"}'</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">mockClient</span> <span class="o">=</span> <span class="n">_MockClient</span><span class="p">();</span>
  <span class="kd">final</span> <span class="n">khaltiHttpClient</span> <span class="o">=</span> <span class="n">KhaltiHttpClient</span><span class="p">(</span><span class="nl">client:</span> <span class="n">client</span><span class="p">);</span>

  <span class="n">test</span><span class="p">(</span>
    <span class="s">'should return HttpResponse.success() if the status code is &gt;= 200 and &lt; 300'</span><span class="p">,</span>
    <span class="p">()</span> <span class="p">{</span>
      <span class="kd">final</span> <span class="n">response</span> <span class="o">=</span> <span class="n">_MockResponse</span><span class="p">();</span>

      <span class="c1">// arrange</span>
      <span class="n">when</span><span class="p">(()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="p">)</span><span class="o">.</span><span class="na">thenReturn</span><span class="p">(</span><span class="n">_testResponseBody</span><span class="p">);</span>
      <span class="n">when</span><span class="p">(()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">response</span><span class="o">.</span><span class="na">statusCode</span><span class="p">)</span><span class="o">.</span><span class="na">thenReturn</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
      <span class="n">when</span><span class="p">(</span>
        <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">client</span><span class="o">.</span><span class="na">get</span><span class="p">(</span>
          <span class="n">any</span><span class="p">(),</span>
          <span class="nl">headers:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'headers'</span><span class="p">),</span>
        <span class="p">),</span>
      <span class="p">)</span><span class="o">.</span><span class="na">thenAnswer</span><span class="p">((</span><span class="n">_</span><span class="p">)</span> <span class="kd">async</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">response</span><span class="p">);</span>

      <span class="c1">// act</span>
      <span class="kd">final</span> <span class="n">result</span> <span class="o">=</span> <span class="n">khaltiHttpClient</span><span class="o">.</span><span class="na">get</span><span class="p">(</span><span class="n">_testUrl</span><span class="p">,</span> <span class="n">_testParams</span><span class="p">);</span>

      <span class="c1">//assert</span>
      <span class="n">expect</span><span class="p">(</span>
        <span class="n">result</span><span class="p">,</span>
        <span class="n">HttpResponse</span><span class="p">(</span>
          <span class="nl">data:</span> <span class="n">jsonDecode</span><span class="p">(</span><span class="n">_testResponseBody</span><span class="p">),</span>
          <span class="nl">statusCode:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="p">),</span>
      <span class="p">);</span>
    <span class="p">},</span>
  <span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Everything looks fine but if we try running this test, the test will fail and the reason is the way we wrote our <code class="language-plaintext highlighter-rouge">expect</code> block.</p><p>Inside the <code class="language-plaintext highlighter-rouge">expect</code> block, we are comparing two different Dart objects. And because Dart works on referential equality i.e. if we are to compare equality of two objects in Dart, then the memory addresses of the two objects are checked. If the memory addresses for both the objects are same, then the objects are equal else unequal.</p><p>So, how can we enforce value equality in Dart? There are few ways. One of them would be to use <a href="https://pub.dev/packages/equatable">equatable</a> package and extend our <code class="language-plaintext highlighter-rouge">HttpRespone</code> class with <code class="language-plaintext highlighter-rouge">Equatable</code>. But this is not always the best idea. What if the <code class="language-plaintext highlighter-rouge">HttpResponse</code> API comes from a third party package? We can’t just change its code if it’s coming from a third party package.</p><p>Another way would be to manually override <code class="language-plaintext highlighter-rouge">hashCode</code> and <code class="language-plaintext highlighter-rouge">==</code>. But again this can’t be considered if <code class="language-plaintext highlighter-rouge">HttpResponse</code> API comes from a third party package.</p><p>So, we take the help of <a href="https://api.flutter.dev/flutter/package-matcher_matcher/TypeMatcher-class.html">TypeMatcher</a> that comes from the <a href="https://pub.dev/packages/test">test</a> package.</p><p>So, in the above test, update the <code class="language-plaintext highlighter-rouge">expect</code> statement to this. 👇️</p><div class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="Dart"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">expect</span><span class="p">(</span>
  <span class="n">result</span><span class="p">,</span>
  <span class="n">isA</span><span class="p">&lt;</span><span class="n">HttpResponse</span><span class="p">&gt;()</span>
      <span class="o">.</span><span class="na">having</span><span class="p">((</span><span class="n">e</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">e</span><span class="o">.</span><span class="na">data</span><span class="p">,</span> <span class="s">'data'</span><span class="p">,</span> <span class="n">jsonDecode</span><span class="p">(</span><span class="n">_testResponseBody</span><span class="p">))</span>
      <span class="o">.</span><span class="na">having</span><span class="p">((</span><span class="n">e</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">e</span><span class="o">.</span><span class="na">statusCode</span><span class="p">,</span> <span class="s">'status code'</span><span class="p">,</span> <span class="n">statusCode</span><span class="p">),</span>
<span class="p">);</span>
</pre></table></code></div></div><p>So, the test would be something like:</p><div class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="Dart"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">mockClient</span> <span class="o">=</span> <span class="n">_MockClient</span><span class="p">();</span>
  <span class="kd">final</span> <span class="n">khaltiHttpClient</span> <span class="o">=</span> <span class="n">KhaltiHttpClient</span><span class="p">(</span><span class="nl">client:</span> <span class="n">client</span><span class="p">);</span>

  <span class="n">test</span><span class="p">(</span>
    <span class="s">'should return HttpResponse.success() if the status code is &gt;= 200 and &lt; 300'</span><span class="p">,</span>
    <span class="p">()</span> <span class="p">{</span>
      <span class="kd">final</span> <span class="n">response</span> <span class="o">=</span> <span class="n">_MockResponse</span><span class="p">();</span>

      <span class="c1">// arrange</span>
      <span class="n">when</span><span class="p">(()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="p">)</span><span class="o">.</span><span class="na">thenReturn</span><span class="p">(</span><span class="n">_testResponseBody</span><span class="p">);</span>
      <span class="n">when</span><span class="p">(()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">response</span><span class="o">.</span><span class="na">statusCode</span><span class="p">)</span><span class="o">.</span><span class="na">thenReturn</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
      <span class="n">when</span><span class="p">(</span>
        <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">client</span><span class="o">.</span><span class="na">get</span><span class="p">(</span>
          <span class="n">any</span><span class="p">(),</span>
          <span class="nl">headers:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'headers'</span><span class="p">),</span>
        <span class="p">),</span>
      <span class="p">)</span><span class="o">.</span><span class="na">thenAnswer</span><span class="p">((</span><span class="n">_</span><span class="p">)</span> <span class="kd">async</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">response</span><span class="p">);</span>

      <span class="c1">// act</span>
      <span class="kd">final</span> <span class="n">result</span> <span class="o">=</span> <span class="n">khaltiHttpClient</span><span class="o">.</span><span class="na">get</span><span class="p">(</span><span class="n">_testUrl</span><span class="p">,</span> <span class="n">_testParams</span><span class="p">);</span>

      <span class="c1">//assert</span>
      <span class="n">expect</span><span class="p">(</span>
        <span class="n">result</span><span class="p">,</span>
        <span class="n">isA</span><span class="p">&lt;</span><span class="n">HttpResponse</span><span class="p">&gt;()</span>
            <span class="o">.</span><span class="na">having</span><span class="p">((</span><span class="n">e</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">e</span><span class="o">.</span><span class="na">data</span><span class="p">,</span> <span class="s">'data'</span><span class="p">,</span> <span class="n">jsonDecode</span><span class="p">(</span><span class="n">_testResponseBody</span><span class="p">))</span>
            <span class="o">.</span><span class="na">having</span><span class="p">((</span><span class="n">e</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">e</span><span class="o">.</span><span class="na">statusCode</span><span class="p">,</span> <span class="s">'status code'</span><span class="p">,</span> <span class="n">statusCode</span><span class="p">),</span>
      <span class="p">);</span>
    <span class="p">},</span>
  <span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>And now if you run the test using the command <code class="language-plaintext highlighter-rouge">flutter test</code>, the test would pass.</p><p>Similarly, if entire code is tested, we will have a test code that looks something like this after some refactoring.</p><div file="file_3_test.dart" class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="file_3_test.dart"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="s">'dart:convert'</span><span class="o">;</span>

<span class="kn">import</span> <span class="s">'package:flutter_test/flutter_test.dart'</span><span class="o">;</span>
<span class="kn">import</span> <span class="s">'package:http/http.dart'</span> <span class="k">as</span> <span class="n">http</span><span class="o">;</span>
<span class="kn">import</span> <span class="s">'package:khalti/khalti.dart'</span><span class="o">;</span>
<span class="kn">import</span> <span class="s">'package:mocktail/mocktail.dart'</span><span class="o">;</span>

<span class="kd">typedef</span> <span class="n">_MethodUnderTestCaller</span> <span class="o">=</span> <span class="n">Future</span><span class="p">&lt;</span><span class="n">HttpResponse</span><span class="p">&gt;</span> <span class="kt">Function</span><span class="p">(</span>
  <span class="kt">String</span><span class="p">,</span>
  <span class="kt">Map</span><span class="p">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Object</span><span class="p">&gt;,</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="n">_testUrl</span> <span class="o">=</span> <span class="s">'www.url.com'</span><span class="p">;</span>
<span class="kd">const</span> <span class="n">_testParams</span> <span class="o">=</span> <span class="p">{</span><span class="s">'key'</span><span class="o">:</span> <span class="s">'value'</span><span class="p">};</span>
<span class="kd">const</span> <span class="n">_testResponseBody</span> <span class="o">=</span> <span class="s">'{"message": "Fake Response"}'</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">_runSuccessOrFailureTest</span><span class="p">({</span>
  <span class="kd">required</span> <span class="kt">int</span> <span class="n">statusCode</span><span class="p">,</span>
  <span class="kd">required</span> <span class="n">Future</span><span class="p">&lt;</span><span class="n">http</span><span class="o">.</span><span class="na">Response</span><span class="p">&gt;</span> <span class="kt">Function</span><span class="p">()</span> <span class="n">stubMethod</span><span class="p">,</span>
  <span class="kd">required</span> <span class="n">_MethodUnderTestCaller</span> <span class="n">caller</span><span class="p">,</span>
<span class="p">})</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">response</span> <span class="o">=</span> <span class="n">_MockResponse</span><span class="p">();</span>

  <span class="n">when</span><span class="p">(()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">response</span><span class="o">.</span><span class="na">statusCode</span><span class="p">)</span><span class="o">.</span><span class="na">thenReturn</span><span class="p">(</span><span class="n">statusCode</span><span class="p">);</span>
  <span class="n">when</span><span class="p">(()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="p">)</span><span class="o">.</span><span class="na">thenReturn</span><span class="p">(</span><span class="n">_testResponseBody</span><span class="p">);</span>
  <span class="n">when</span><span class="p">(</span><span class="n">stubMethod</span><span class="p">)</span><span class="o">.</span><span class="na">thenAnswer</span><span class="p">((</span><span class="n">_</span><span class="p">)</span> <span class="kd">async</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">response</span><span class="p">);</span>

  <span class="kd">final</span> <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">caller</span><span class="p">(</span><span class="n">_testUrl</span><span class="p">,</span> <span class="n">_testParams</span><span class="p">);</span>

  <span class="n">expect</span><span class="p">(</span>
    <span class="n">result</span><span class="p">,</span>
    <span class="n">isA</span><span class="p">&lt;</span><span class="n">HttpResponse</span><span class="p">&gt;()</span>
        <span class="o">.</span><span class="na">having</span><span class="p">((</span><span class="n">e</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">e</span><span class="o">.</span><span class="na">data</span><span class="p">,</span> <span class="s">'data'</span><span class="p">,</span> <span class="n">jsonDecode</span><span class="p">(</span><span class="n">_testResponseBody</span><span class="p">))</span>
        <span class="o">.</span><span class="na">having</span><span class="p">((</span><span class="n">e</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">e</span><span class="o">.</span><span class="na">statusCode</span><span class="p">,</span> <span class="s">'status code'</span><span class="p">,</span> <span class="n">statusCode</span><span class="p">),</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">_runExceptionTest</span><span class="p">({</span>
  <span class="kd">required</span> <span class="n">Exception</span> <span class="n">exception</span><span class="p">,</span>
  <span class="kd">required</span> <span class="n">Future</span><span class="p">&lt;</span><span class="n">http</span><span class="o">.</span><span class="na">Response</span><span class="p">&gt;</span> <span class="kt">Function</span><span class="p">()</span> <span class="n">stubMethod</span><span class="p">,</span>
  <span class="kd">required</span> <span class="n">_MethodUnderTestCaller</span> <span class="n">caller</span><span class="p">,</span>
<span class="p">})</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="n">when</span><span class="p">(</span><span class="n">stubMethod</span><span class="p">)</span><span class="o">.</span><span class="na">thenThrow</span><span class="p">(</span><span class="n">exception</span><span class="p">);</span>

  <span class="kd">final</span> <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">caller</span><span class="p">(</span><span class="n">_testUrl</span><span class="p">,</span> <span class="n">_testParams</span><span class="p">);</span>

  <span class="n">expect</span><span class="p">(</span>
    <span class="n">result</span><span class="p">,</span>
    <span class="n">isA</span><span class="p">&lt;</span><span class="n">HttpResponse</span><span class="p">&gt;()</span>
        <span class="o">.</span><span class="na">having</span><span class="p">((</span><span class="n">e</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">e</span><span class="o">.</span><span class="na">data</span><span class="p">,</span> <span class="s">'data'</span><span class="p">,</span> <span class="n">isNull</span><span class="p">)</span>
        <span class="o">.</span><span class="na">having</span><span class="p">((</span><span class="n">e</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">e</span><span class="o">.</span><span class="na">statusCode</span><span class="p">,</span> <span class="s">'status code'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="o">.</span><span class="na">having</span><span class="p">((</span><span class="n">e</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">e</span><span class="o">.</span><span class="na">message</span><span class="p">,</span> <span class="s">'exception'</span><span class="p">,</span> <span class="s">'Exception'</span><span class="p">),</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">mockClient</span> <span class="o">=</span> <span class="n">_MockClient</span><span class="p">();</span>
  <span class="kd">final</span> <span class="n">khaltiHttpClient</span> <span class="o">=</span> <span class="n">KhaltiHttpClient</span><span class="p">(</span><span class="nl">client:</span> <span class="n">mockClient</span><span class="p">);</span>

  <span class="n">setUpAll</span><span class="p">(()</span> <span class="p">{</span>
    <span class="n">registerFallbackValue</span><span class="p">(</span><span class="n">_FakeUri</span><span class="p">());</span>
  <span class="p">});</span>

  <span class="n">group</span><span class="p">(</span>
    <span class="s">'KhaltiHttpClient constructor'</span><span class="p">,</span>
    <span class="p">()</span> <span class="p">{</span>
      <span class="n">test</span><span class="p">(</span>
        <span class="s">'instantiates internal httpClient when not injected'</span><span class="p">,</span>
        <span class="p">()</span> <span class="p">{</span>
          <span class="n">expect</span><span class="p">(</span><span class="n">KhaltiHttpClient</span><span class="p">(),</span> <span class="n">isNotNull</span><span class="p">);</span>
        <span class="p">},</span>
      <span class="p">);</span>
    <span class="p">},</span>
  <span class="p">);</span>

  <span class="n">group</span><span class="p">(</span>
    <span class="s">'KhaltiHttpClient |'</span><span class="p">,</span>
    <span class="p">()</span> <span class="p">{</span>
      <span class="n">group</span><span class="p">(</span>
        <span class="s">'get():'</span><span class="p">,</span>
        <span class="p">()</span> <span class="p">{</span>
          <span class="n">test</span><span class="p">(</span>
            <span class="s">'should return HttpResponse.success() if the status code is &gt;= 200 and &lt; 300'</span><span class="p">,</span>
            <span class="p">()</span> <span class="p">{</span>
              <span class="n">_runSuccessOrFailureTest</span><span class="p">(</span>
                <span class="nl">statusCode:</span> <span class="mi">200</span><span class="p">,</span>
                <span class="nl">stubMethod:</span> <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">mockClient</span><span class="o">.</span><span class="na">get</span><span class="p">(</span>
                  <span class="n">any</span><span class="p">(),</span>
                  <span class="nl">headers:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'headers'</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="nl">caller:</span> <span class="n">khaltiHttpClient</span><span class="o">.</span><span class="na">get</span><span class="p">,</span>
              <span class="p">);</span>
            <span class="p">},</span>
          <span class="p">);</span>

          <span class="n">test</span><span class="p">(</span>
            <span class="s">'should return HttpResponse.failure() if the status code is &gt;= 400 and &lt;600'</span><span class="p">,</span>
            <span class="p">()</span> <span class="p">{</span>
              <span class="n">_runSuccessOrFailureTest</span><span class="p">(</span>
                <span class="nl">statusCode:</span> <span class="mi">404</span><span class="p">,</span>
                <span class="nl">stubMethod:</span> <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">mockClient</span><span class="o">.</span><span class="na">get</span><span class="p">(</span>
                  <span class="n">any</span><span class="p">(),</span>
                  <span class="nl">headers:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'headers'</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="nl">caller:</span> <span class="n">khaltiHttpClient</span><span class="o">.</span><span class="na">get</span><span class="p">,</span>
              <span class="p">);</span>
            <span class="p">},</span>
          <span class="p">);</span>

          <span class="n">test</span><span class="p">(</span>
            <span class="s">'should return HttpResponse.exception() if HttpException is thrown'</span><span class="p">,</span>
            <span class="p">()</span> <span class="p">{</span>
              <span class="n">_runExceptionTest</span><span class="p">(</span>
                <span class="nl">exception:</span> <span class="kd">const</span> <span class="n">HttpException</span><span class="p">(</span><span class="s">'Exception'</span><span class="p">),</span>
                <span class="nl">stubMethod:</span> <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">mockClient</span><span class="o">.</span><span class="na">get</span><span class="p">(</span>
                  <span class="n">any</span><span class="p">(),</span>
                  <span class="nl">headers:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'headers'</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="nl">caller:</span> <span class="n">khaltiHttpClient</span><span class="o">.</span><span class="na">get</span><span class="p">,</span>
              <span class="p">);</span>
            <span class="p">},</span>
          <span class="p">);</span>

          <span class="n">test</span><span class="p">(</span>
            <span class="s">'should return HttpResponse.exception() if ClientException is thrown'</span><span class="p">,</span>
            <span class="p">()</span> <span class="p">{</span>
              <span class="n">_runExceptionTest</span><span class="p">(</span>
                <span class="nl">exception:</span> <span class="n">http</span><span class="o">.</span><span class="na">ClientException</span><span class="p">(</span><span class="s">'Exception'</span><span class="p">),</span>
                <span class="nl">stubMethod:</span> <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">mockClient</span><span class="o">.</span><span class="na">get</span><span class="p">(</span>
                  <span class="n">any</span><span class="p">(),</span>
                  <span class="nl">headers:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'headers'</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="nl">caller:</span> <span class="n">khaltiHttpClient</span><span class="o">.</span><span class="na">get</span><span class="p">,</span>
              <span class="p">);</span>
            <span class="p">},</span>
          <span class="p">);</span>

          <span class="n">test</span><span class="p">(</span>
            <span class="s">'should return HttpResponse.exception() if SocketException is thrown'</span><span class="p">,</span>
            <span class="p">()</span> <span class="p">{</span>
              <span class="n">_runExceptionTest</span><span class="p">(</span>
                <span class="nl">exception:</span> <span class="kd">const</span> <span class="n">SocketException</span><span class="p">(</span><span class="s">'Exception'</span><span class="p">),</span>
                <span class="nl">stubMethod:</span> <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">mockClient</span><span class="o">.</span><span class="na">get</span><span class="p">(</span>
                  <span class="n">any</span><span class="p">(),</span>
                  <span class="nl">headers:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'headers'</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="nl">caller:</span> <span class="n">khaltiHttpClient</span><span class="o">.</span><span class="na">get</span><span class="p">,</span>
              <span class="p">);</span>
            <span class="p">},</span>
          <span class="p">);</span>

          <span class="n">test</span><span class="p">(</span>
            <span class="s">'should return HttpResponse.exception() if FormatException is thrown'</span><span class="p">,</span>
            <span class="p">()</span> <span class="p">{</span>
              <span class="n">_runExceptionTest</span><span class="p">(</span>
                <span class="nl">exception:</span> <span class="kd">const</span> <span class="n">FormatException</span><span class="p">(</span><span class="s">'Exception'</span><span class="p">),</span>
                <span class="nl">stubMethod:</span> <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">mockClient</span><span class="o">.</span><span class="na">get</span><span class="p">(</span>
                  <span class="n">any</span><span class="p">(),</span>
                  <span class="nl">headers:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'headers'</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="nl">caller:</span> <span class="n">khaltiHttpClient</span><span class="o">.</span><span class="na">get</span><span class="p">,</span>
              <span class="p">);</span>
            <span class="p">},</span>
          <span class="p">);</span>

          <span class="n">test</span><span class="p">(</span>
            <span class="s">'should return HttpResponse.exception() if any Exception is thrown'</span><span class="p">,</span>
            <span class="p">()</span> <span class="p">{</span>
              <span class="n">_runExceptionTest</span><span class="p">(</span>
                <span class="nl">exception:</span> <span class="n">Exception</span><span class="p">(),</span>
                <span class="nl">stubMethod:</span> <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">mockClient</span><span class="o">.</span><span class="na">get</span><span class="p">(</span>
                  <span class="n">any</span><span class="p">(),</span>
                  <span class="nl">headers:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'headers'</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="nl">caller:</span> <span class="n">khaltiHttpClient</span><span class="o">.</span><span class="na">get</span><span class="p">,</span>
              <span class="p">);</span>
            <span class="p">},</span>
          <span class="p">);</span>
        <span class="p">},</span>
      <span class="p">);</span>

      <span class="n">group</span><span class="p">(</span>
        <span class="s">'post():'</span><span class="p">,</span>
        <span class="p">()</span> <span class="p">{</span>
          <span class="n">test</span><span class="p">(</span>
            <span class="s">'should return HttpResponse.success() if the status code is &gt;= 200 and &lt; 300'</span><span class="p">,</span>
            <span class="p">()</span> <span class="p">{</span>
              <span class="n">_runSuccessOrFailureTest</span><span class="p">(</span>
                <span class="nl">statusCode:</span> <span class="mi">200</span><span class="p">,</span>
                <span class="nl">stubMethod:</span> <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">mockClient</span><span class="o">.</span><span class="na">post</span><span class="p">(</span>
                  <span class="n">any</span><span class="p">(),</span>
                  <span class="nl">body:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'body'</span><span class="p">),</span>
                  <span class="nl">headers:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'headers'</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="nl">caller:</span> <span class="n">khaltiHttpClient</span><span class="o">.</span><span class="na">post</span><span class="p">,</span>
              <span class="p">);</span>
            <span class="p">},</span>
          <span class="p">);</span>

          <span class="n">test</span><span class="p">(</span>
            <span class="s">'should return HttpResponse.failure() if the status code is &gt;= 400 and &lt;600'</span><span class="p">,</span>
            <span class="p">()</span> <span class="p">{</span>
              <span class="n">_runSuccessOrFailureTest</span><span class="p">(</span>
                <span class="nl">statusCode:</span> <span class="mi">404</span><span class="p">,</span>
                <span class="nl">stubMethod:</span> <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">mockClient</span><span class="o">.</span><span class="na">post</span><span class="p">(</span>
                  <span class="n">any</span><span class="p">(),</span>
                  <span class="nl">body:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'body'</span><span class="p">),</span>
                  <span class="nl">headers:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'headers'</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="nl">caller:</span> <span class="n">khaltiHttpClient</span><span class="o">.</span><span class="na">post</span><span class="p">,</span>
              <span class="p">);</span>
            <span class="p">},</span>
          <span class="p">);</span>

          <span class="n">test</span><span class="p">(</span>
            <span class="s">'should return HttpResponse.exception() if HttpException is thrown'</span><span class="p">,</span>
            <span class="p">()</span> <span class="p">{</span>
              <span class="n">_runExceptionTest</span><span class="p">(</span>
                <span class="nl">exception:</span> <span class="kd">const</span> <span class="n">HttpException</span><span class="p">(</span><span class="s">'Exception'</span><span class="p">),</span>
                <span class="nl">stubMethod:</span> <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">mockClient</span><span class="o">.</span><span class="na">post</span><span class="p">(</span>
                  <span class="n">any</span><span class="p">(),</span>
                  <span class="nl">body:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'body'</span><span class="p">),</span>
                  <span class="nl">headers:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'headers'</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="nl">caller:</span> <span class="n">khaltiHttpClient</span><span class="o">.</span><span class="na">post</span><span class="p">,</span>
              <span class="p">);</span>
            <span class="p">},</span>
          <span class="p">);</span>

          <span class="n">test</span><span class="p">(</span>
            <span class="s">'should return HttpResponse.exception() if ClientException is thrown'</span><span class="p">,</span>
            <span class="p">()</span> <span class="p">{</span>
              <span class="n">_runExceptionTest</span><span class="p">(</span>
                <span class="nl">exception:</span> <span class="n">http</span><span class="o">.</span><span class="na">ClientException</span><span class="p">(</span><span class="s">'Exception'</span><span class="p">),</span>
                <span class="nl">stubMethod:</span> <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">mockClient</span><span class="o">.</span><span class="na">post</span><span class="p">(</span>
                  <span class="n">any</span><span class="p">(),</span>
                  <span class="nl">body:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'body'</span><span class="p">),</span>
                  <span class="nl">headers:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'headers'</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="nl">caller:</span> <span class="n">khaltiHttpClient</span><span class="o">.</span><span class="na">post</span><span class="p">,</span>
              <span class="p">);</span>
            <span class="p">},</span>
          <span class="p">);</span>

          <span class="n">test</span><span class="p">(</span>
            <span class="s">'should return HttpResponse.exception() if SocketException is thrown'</span><span class="p">,</span>
            <span class="p">()</span> <span class="p">{</span>
              <span class="n">_runExceptionTest</span><span class="p">(</span>
                <span class="nl">exception:</span> <span class="kd">const</span> <span class="n">SocketException</span><span class="p">(</span><span class="s">'Exception'</span><span class="p">),</span>
                <span class="nl">stubMethod:</span> <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">mockClient</span><span class="o">.</span><span class="na">post</span><span class="p">(</span>
                  <span class="n">any</span><span class="p">(),</span>
                  <span class="nl">body:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'body'</span><span class="p">),</span>
                  <span class="nl">headers:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'headers'</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="nl">caller:</span> <span class="n">khaltiHttpClient</span><span class="o">.</span><span class="na">post</span><span class="p">,</span>
              <span class="p">);</span>
            <span class="p">},</span>
          <span class="p">);</span>

          <span class="n">test</span><span class="p">(</span>
            <span class="s">'should return HttpResponse.exception() if FormatException is thrown'</span><span class="p">,</span>
            <span class="p">()</span> <span class="p">{</span>
              <span class="n">_runExceptionTest</span><span class="p">(</span>
                <span class="nl">exception:</span> <span class="kd">const</span> <span class="n">FormatException</span><span class="p">(</span><span class="s">'Exception'</span><span class="p">),</span>
                <span class="nl">stubMethod:</span> <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">mockClient</span><span class="o">.</span><span class="na">post</span><span class="p">(</span>
                  <span class="n">any</span><span class="p">(),</span>
                  <span class="nl">body:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'body'</span><span class="p">),</span>
                  <span class="nl">headers:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'headers'</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="nl">caller:</span> <span class="n">khaltiHttpClient</span><span class="o">.</span><span class="na">post</span><span class="p">,</span>
              <span class="p">);</span>
            <span class="p">},</span>
          <span class="p">);</span>

          <span class="n">test</span><span class="p">(</span>
            <span class="s">'should return HttpResponse.exception() if any Exception is thrown'</span><span class="p">,</span>
            <span class="p">()</span> <span class="p">{</span>
              <span class="n">_runExceptionTest</span><span class="p">(</span>
                <span class="nl">exception:</span> <span class="n">Exception</span><span class="p">(),</span>
                <span class="nl">stubMethod:</span> <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">mockClient</span><span class="o">.</span><span class="na">post</span><span class="p">(</span>
                  <span class="n">any</span><span class="p">(),</span>
                  <span class="nl">body:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'body'</span><span class="p">),</span>
                  <span class="nl">headers:</span> <span class="n">any</span><span class="p">(</span><span class="nl">named:</span> <span class="s">'headers'</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="nl">caller:</span> <span class="n">khaltiHttpClient</span><span class="o">.</span><span class="na">post</span><span class="p">,</span>
              <span class="p">);</span>
            <span class="p">},</span>
          <span class="p">);</span>
        <span class="p">},</span>
      <span class="p">);</span>
    <span class="p">},</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">_MockClient</span> <span class="kd">extends</span> <span class="n">Mock</span> <span class="kd">implements</span> <span class="n">http</span><span class="o">.</span><span class="na">Client</span> <span class="p">{}</span>

<span class="kd">class</span> <span class="nc">_MockResponse</span> <span class="kd">extends</span> <span class="n">Mock</span> <span class="kd">implements</span> <span class="n">http</span><span class="o">.</span><span class="na">Response</span> <span class="p">{}</span>

<span class="kd">class</span> <span class="nc">_FakeUri</span> <span class="kd">extends</span> <span class="n">Fake</span> <span class="kd">implements</span> <span class="kt">Uri</span> <span class="p">{}</span>
</pre></table></code></div></div><h2 id="checking-code-coverage"><span class="mr-2">Checking Code Coverage</span><a href="#checking-code-coverage" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>After writing the test and successfully running it, you might want to check if you tested every part of your code. The way you can find that is by checking the <code class="language-plaintext highlighter-rouge">code-coverage</code>. In order to do so in flutter, follow the following steps.</p><ul><li>First, run the command <code class="language-plaintext highlighter-rouge">flutter test --coverage</code> (Make sure that you are in the root project directory in your terminal).<li>After running the above command, a new directory by the name <code class="language-plaintext highlighter-rouge">coverage</code> would appear in the root directory which contains a single file <code class="language-plaintext highlighter-rouge">lcov.info</code>.<li>Now, copy the command shown below, paste it in the terminal and run it.</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>genhtml ./coverage/lcov.info <span class="nt">-o</span> coverage
</pre></table></code></div></div><blockquote class="prompt-info"><div><p><em>Make sure to install <code class="language-plaintext highlighter-rouge">lcov</code> in your system to run <code class="language-plaintext highlighter-rouge">genhtml</code> command.</em></p></div></blockquote><ul><li>If everything is fine, then bunch of files will be created inside the coverage directory. It will have a file named <code class="language-plaintext highlighter-rouge">index.html</code>. Open the file in your browser and you should see a web page opened that looks something like this. <img data-src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/m82jthcq2wdduo5fl6lv.png" alt="Screenshot displaying code coverage in the browser" data-proofer-ignore> You can see more information about what lines are untested (if there are any) by opening the file by clicking on the file name.</ul><p>Alternatively, if you are using VS Code, you can also install extensions like <a href="https://marketplace.visualstudio.com/items?itemName=ryanluker.vscode-coverage-gutters">coverage gutters</a> or <a href="https://marketplace.visualstudio.com/items?itemName=Flutterando.flutter-coverage">flutter coverage</a> that helps in viewing code coverage right inside VS Code.</p><h2 id="conclusion"><span class="mr-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>So, that was it. In this blog, we learned about unit testing, and about what, why and how of unit testing. Unit testing is a fun task to do as you get used to with it.</p><p>You can always check existing open-source projects to learn more about unit tests and to see how others do it. If you enjoyed reading this blog and found that it helped to hone your skill as a developer, then please share the blog among your developer friends. If there is any feedback you’d want to leave, please do so in the comments section below.</p><p>If you wish to see some Flutter projects with proper architecture, follow me on <a href="https://github.com/Biplab-Dutta/">GitHub</a>. I am also active on Twitter <a href="https://twitter.com/b_plab98">@b_plab</a> where I tweet about Flutter and Android.</p><p><strong>My Socials:</strong></p><div class="table-wrapper"><table><tbody><tr><td><a href="https://github.com/Biplab-Dutta/">GitHub</a><td><a href="https://www.linkedin.com/in/biplab-dutta-43774717a/">LinkedIn</a><td><a href="https://twitter.com/b_plab98">Twitter</a></table></div><p>Until next time, happy coding!!! 👨‍💻</p><p>— Biplab Dutta</p><h2 id="credit"><span class="mr-2">Credit</span><a href="#credit" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="https://www.raywenderlich.com/">raywenderlich.com</a> for the preview image.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/flutter/'>flutter</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/flutter/" class="post-tag no-text-decoration" >flutter</a> <a href="/tags/dart/" class="post-tag no-text-decoration" >dart</a> <a href="/tags/unit-test/" class="post-tag no-text-decoration" >unit test</a> <a href="/tags/testing/" class="post-tag no-text-decoration" >testing</a> <a href="/tags/code-coverage/" class="post-tag no-text-decoration" >code coverage</a> <a href="/tags/mocktail/" class="post-tag no-text-decoration" >mocktail</a> <a href="/tags/mocks/" class="post-tag no-text-decoration" >mocks</a> <a href="/tags/fakes/" class="post-tag no-text-decoration" >fakes</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=A+deep+dive+into+unit+testing+in+Flutter+%F0%9F%A7%AA+-+Biplab+Dutta&url=https%3A%2F%2Fbiplabdutta.com.np%2Fposts%2Funit-test%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=A+deep+dive+into+unit+testing+in+Flutter+%F0%9F%A7%AA+-+Biplab+Dutta&u=https%3A%2F%2Fbiplabdutta.com.np%2Fposts%2Funit-test%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fbiplabdutta.com.np%2Fposts%2Funit-test%2F&text=A+deep+dive+into+unit+testing+in+Flutter+%F0%9F%A7%AA+-+Biplab+Dutta" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fbiplabdutta.com.np%2Fposts%2Funit-test%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/exception-handling/">Exception Handling with Functional Programming in Flutter (Either type)</a><li><a href="/posts/reactive-programming/">A Taste of Reactive Programming in Flutter with RxDart and flutter_bloc</a><li><a href="/posts/form-validation/">Form Validation in Flutter using flutter_bloc and Functional Programming (Either)—A Proper Way</a><li><a href="/posts/product-flavors/">Product Flavors in Flutter—Create admin and non-admin apps with distinct UI with a single codebase</a><li><a href="/posts/theme-switching/">Theme Switching & Persisting in Flutter using cubits and Stream</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/dart/">dart</a> <a class="post-tag" href="/tags/flutter/">flutter</a> <a class="post-tag" href="/tags/either/">either</a> <a class="post-tag" href="/tags/flutter-bloc/">flutter_bloc</a> <a class="post-tag" href="/tags/functional-programming/">functional programming</a> <a class="post-tag" href="/tags/stream/">stream</a> <a class="post-tag" href="/tags/build-variants/">build variants</a> <a class="post-tag" href="/tags/code-coverage/">code coverage</a> <a class="post-tag" href="/tags/cubits/">cubits</a> <a class="post-tag" href="/tags/fakes/">fakes</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/exception-handling/"><div class="card-body"> <em class="small" data-ts="1651306500" data-df="ll" > Apr 30, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Exception Handling with Functional Programming in Flutter (Either type)</h3><div class="text-muted small"><p> Every application needs some data sources to receive the data and display it in the UI. So, it becomes very crucial how we, as developers, perform network requests. Handling API responses in an eff...</p></div></div></a></div><div class="card"> <a href="/posts/reactive-programming/"><div class="card-body"> <em class="small" data-ts="1651922100" data-df="ll" > May 7, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>A Taste of Reactive Programming in Flutter with RxDart and flutter_bloc</h3><div class="text-muted small"><p> When it comes to reactive programming, not many developers, especially junior developers feel comfortable with it. The base for reactive programming in Dart is Stream, a type in dart used to repres...</p></div></div></a></div><div class="card"> <a href="/posts/form-validation/"><div class="card-body"> <em class="small" data-ts="1652606100" data-df="ll" > May 15, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Form Validation in Flutter using flutter_bloc and Functional Programming (Either)—A Proper Way</h3><div class="text-muted small"><p> Dealing with forms is a very common task that we encounter as mobile application developers. With forms come form validation. It is necessary to show relevant warnings to the users when they don’t ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/theme-switching/" class="btn btn-outline-primary" prompt="Older"><p>Theme Switching & Persisting in Flutter using cubits and Stream</p></a><div class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></div></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://biplabdutta.com.np/posts/unit-test/'; this.page.identifier = '/posts/unit-test/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://personal-blogging-site.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/b_plab98">Biplab Dutta</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/dart/">dart</a> <a class="post-tag" href="/tags/flutter/">flutter</a> <a class="post-tag" href="/tags/either/">either</a> <a class="post-tag" href="/tags/flutter-bloc/">flutter_bloc</a> <a class="post-tag" href="/tags/functional-programming/">functional programming</a> <a class="post-tag" href="/tags/stream/">stream</a> <a class="post-tag" href="/tags/build-variants/">build variants</a> <a class="post-tag" href="/tags/code-coverage/">code coverage</a> <a class="post-tag" href="/tags/cubits/">cubits</a> <a class="post-tag" href="/tags/fakes/">fakes</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
